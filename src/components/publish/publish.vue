<template>
    <div class="quill-wrap">
        <quill-editor v-model="content"
            ref="myQuillEditor"
            :options="editorOption">
        </quill-editor>
        <button @click.stop="showContent">提交</button>
    </div>
</template>

<script>
import {randomString} from '../../assets/js/common.js'
// 引入quill-image-resize-module组件,调整图片大小
import {container, ImageExtend, QuillWatch} from 'quill-image-extend-module'
import ImageResize from 'quill-image-resize-module'
Quill.register('modules/imageExtend', ImageExtend)
Quill.register('modules/imageResize', ImageResize)
// 引入highlight.js插件,用以实现代码高亮功能
import hljs from 'highlight.js'
hljs.configure({
  languages: ['javascript', 'html', 'css', 'java', 'ruby', 'python', 'php']
})
export default {
    name: 'publish',
    data () {
      return {
        // content: '<h2>I am Example</h2>',
        content: `<p><span style="color: rgb(51, 51, 51); background-color: rgb(253, 253, 253);">9月22号开始玩，陆陆续续拾起来玩到今天，用了50小时左右打通了游戏，完成了所有支线。</span></p><p><img src="http://qny95cix6.hn-bkt.clouddn.com/RrxbY8tHZhAea6CRixbwiA8DPQkA6kt7X8Ct4QdTrjPydkiEYWHARCCeiBWzCFDEfinal.jpg" style="display: block; margin: auto;" width="600"></p><p class="ql-align-center"><span style="color: rgb(136, 136, 136);">游戏界面</span></p><p class="ql-align-center"><br></p><h2><strong>游戏数据</strong></h2><p><img src="http://qny95cix6.hn-bkt.clouddn.com/PYMSSXJHwzT5w3ymYzEP7cCcwTESC37RxsWhRZpTnXNtcmZGfib3NGEK86QKwiBasub.jpg" style="display: block; margin: auto;" width="600"></p><p class="ql-align-center"><span style="color: rgb(136, 136, 136);">主线彩旗飘飘</span></p><p class="ql-align-center"><br></p><ul><li>通关时间消耗：50小时稍出</li><li>支线完成度：100%</li></ul><h2><strong>整体感受</strong></h2><p><img src="http://qny95cix6.hn-bkt.clouddn.com/sm8PwsitecdS4hkF6mzCwRycmrYNzMwRCnaNtGDXsaYcNhKTiwFmHJd83M8BkaD2main.jpg" style="display: block; margin: auto;" width="600"></p><p class="ql-align-center"><span style="color: rgb(136, 136, 136);">主线剧情</span></p><p>游戏剧情很松散，配合像素风格的画面，有一种回到过去，玩&nbsp;<code class="ql-font-monospace" style="color: rgb(51, 51, 51); background-color: rgb(228, 228, 228);">GameBoy</code>&nbsp;和&nbsp;<code class="ql-font-monospace" style="color: rgb(51, 51, 51); background-color: rgb(228, 228, 228);">Nokia Symbian</code>&nbsp;游戏的感觉。但是借助 Switch 强大机器性能，景深、音乐、特效可以带来不同的娱乐舒适体验。</p><p>游戏偏所谓<code class="ql-font-monospace" style="color: rgb(51, 51, 51); background-color: rgb(228, 228, 228);">硬核</code>，数值设置不是很合理，因为更复古的设定，跑地图的设定相比现在的游戏来说，会稍微麻烦一些，不过搭配景深进行视觉欺骗，把野外洞穴藏起来，也算是一种轻度解密设定了吧。</p><p><br></p><h2><strong>游戏优点</strong></h2><p><img src="http://qny95cix6.hn-bkt.clouddn.com/WBQ38tTz5QeX7SsSnna3jMMN2QAPWEsjDknNYjTtrsJfaSmw7zM4dPtYtcdbPQMtend.jpg" style="display: block; margin: auto;" width="600"></p><p class="ql-align-center"><span style="color: rgb(136, 136, 136);">最终决战</span></p><p class="ql-align-center"><br></p><ul><li>很久没有认真听BGM了，直到打开了八方旅人之后，时而舒缓时而紧凑，相比较许多游戏一首BGM从头播到尾，很有诚意。</li><li>画面设定有点像一些老游戏，比如《浪漫沙迦》，或者更老的掌机游戏《勇者斗恶龙》、《太空战士（时空的霸者）》，应该很讨老玩家的喜欢。</li><li>相对开放的剧情，毕竟有八个角色可以攻略，而且无所谓从谁先开始，最后一个完结哪个剧情。并且支线剧情比较多，解锁完毕魔女和魔神后代任务之后，还可以触发解救魔神后代的任务。</li><li>支线剧情有一些设置比较有趣，包括完成任务之后的后续，但是也有许多是滥竽充数的。</li></ul><p><br></p><p class="ql-align-center"><span style="color: rgb(136, 136, 136);">游戏结束了,而旅程才刚开始</span></p><p><br></p><p>网上太多不负责任转载，各种乱转，甚至有说魔神后裔是黄头发小姑凉的，这里主要讲解一下如何完成前置支线，然后开启号角堡终焉之门魔神关卡。</p><p>这个关卡主要讲的是魔女引诱魔神后裔进入终焉之门，然后给玩家击败魔王拯救世界的机会的挑战。</p><p>但是在支线战斗开启之前，我们的魔女和魔神后裔都比较迷茫，所以需要玩家的帮助来走上正确的命运之旅。</p><p><br></p><h3><strong>士兵阿尔法斯支线</strong></h3><ul><li>阿尔法斯，在盗贼初始城镇危石镇的瑞斯瓦宅邸门外左侧围栏附近，有一个外表坚强，内容彷徨的青年，他痴痴的望着对面的女士，但是不敢上前表白，而女士恰好也在寻找她的真命天子。为了拯救这对痴男怨女，玩家手里的剑客当然是要二话不说拔刀相助，胖揍这个懦弱的士兵之后，女士会注意到这个士兵，不过这位名叫里布拉克的女子会匆匆离开。</li><li>阿尔法斯这次出现在了圣桥镇，这个人保持着他自己一贯的爱情观“爱她就要默默守护她”，就是不去和喜欢的菇凉表白，作为玩家当然看不下去了，于是跑到这个镇的教堂右边找到弗洛拉帮助他们完成美好情缘。</li></ul><h3><strong>寻找父亲的克里斯支线</strong></h3><ul><li>克里斯第一次出现在玩家第一个角色城镇附近，因为受到魔物攻击，脚受伤不能行动了，在玩家分给他一个“HP回复普通”之后，他会感谢玩家，然后继续踏上寻找下落不明的父亲的旅程。</li><li>克里斯在寻找父亲的过程中，走到了贵族之廷，觉得一个人的旅行已经到达极限了，急需伙伴陪同一起将旅行进行下去，作为玩家，当然是要帮助他啦，在城镇右侧地图中找到一个有表现欲的演员，可以使用引导或者诱惑将此人带给他，于是他们就会一同加入旅行剧团，开始新的旅程。</li><li>克里斯在加入旅行剧团一段时间后，我们在月隐海路再次相逢，这次克里斯终于觉悟，寻找父亲这件事必须全身心的投入，所以不得不离开这个旅行剧团，但是在离开之前他想送团长一个礼物来报答团长长期以来的照顾之情，作为好心的玩家当然是满足他的愿望。于是玩家跑到宏港的商区，从一个商人身上获得到了克里斯想要的“天青石”，在把物品交给克里斯之后，克里斯便可以继续安心上路了。</li></ul><h3><strong>旅行艺人团长和阿尔法斯支线</strong></h3><ul><li>在完成上面两个支线后，玩家来到猎人初始城镇隐雾村，从北侧村口出门，在西隐雾森路遇到了旅行艺人团长，团长见到玩家道出了前方高能的警告，并告诉玩家有一位壮士已经效仿武松前去和前方不远处的魔物进行战斗了。话音未落，这个壮士就败阵下来，壮士抬头，玩家一看，这不是之前不敢对心爱菇凉告别的士兵嘛。士兵仿佛看到了救世主爸爸，团长也发现诶呀妈，都认识啊，那么我们这些战五渣就不要再去螳臂当车当炮灰了，一顿鼓吹，让无所不能的救世主玩家前去浇灭魔物。玩家当仁不让，几个回合下来灭了拦路的野生动物后，团长和士兵分别道出了之前的旅团小伙伴克里斯、追求女士里布拉克都去了号角堡的遗迹，说罢帮助玩家开启了大地图永驻镇右下方的号角堡遗迹的传送点，终焉之战正式开启。</li></ul><h3>最后通关队伍搭配</h3><p>一阶段队伍思路：</p><p><br></p><ul><li>主力输出：盗贼副职业武艺家，化身纯物理菜刀，在星咏和商人的供给下可以做到最差两回合施放一次豪武匠温希尔德的咆哮，大概4~5次，BOSS就跪了。</li><li>破盾辅助：学者副职业魔术师，化身纯法系输出，上场用BP探测BOSS弱点，然后使用魔术师技能3连击快速破盾，让盗贼输出最大化。</li><li>吸收伤害：剑客副职业星咏，充当坦克肉盾，不断施放嘲讽，有时间就给输出施放BP持续翻倍恢复增益。</li><li>后勤补给：神官副职业商人，做辅助角色，不断给输出贡献BP，以及时不时进行全队回复。</li></ul><p>二阶段队伍思路：</p><p><br></p><ul><li>主力输出：猎人副职业带符文大师，猎人连发技能配合符文能力追加伤害，既能破盾又有输出，二阶段有一个BOSS部位只吃魔法伤害，直接用魔剑士巴洛格的霸气一顿削。</li><li>破盾辅助：舞者副职业盗贼，疯狂破盾以及供给其他角色魔法，顺便使用道具。</li><li>吸收伤害：药师副职业剑客，不断嘲讽以及使用调和方式进行破盾操作，偶尔BP用不完就用雷剑将布兰德的刚击。</li><li>后勤补给：商人副职业神官，二阶段压力感觉比一阶段大一些，需要不断加血，偶尔有机会，就给输出爸爸们贡献BP，一般需要留着BP进行全体恢复。</li></ul><p><br></p><p><br></p><h2><strong>最后</strong></h2><p><img src="http://qny95cix6.hn-bkt.clouddn.com/XKcCKBt75CGWy8EeGxaFBFpsfEJWHjkcbGeXfpsYpa427xyEtDkb2NQF2mP8RyhA微信图片_20210109170839.jpg" style="display: block; margin: auto; cursor: nwse-resize;" width="337"></p><p>如游戏所说，人生就是一场旅途，你想经历体验的事情都是可以由你来决定的。</p><p>—EOF</p><p><br></p>`.replace(/\"/g,"'"),
        qiniuhost: 'http://qny95cix6.hn-bkt.clouddn.com/',
        // editorOption: quillConfig,
        // vue-quill-editor配置项
        editorOption: {
          modules: {
            imageResize: {
              displayStyles: {   
                //添加
                backgroundColor: 'black',
                border: 'none',
                color: 'white'
              },
              modules: ['Resize', 'DisplaySize', 'Toolbar']   //添加
            },
            imageExtend: {
              name: 'file',
              size: 3,  // 单位为M, 1M = 1024KB
              action: `http://upload-z2.qiniup.com`,
              response: (res) => {
                return this.qiniuhost + res.key;
              },
              change: function(xhr, formData) {
                let file = formData.get('file');
                if(allowType.indexOf(file.type) === -1){
                  console.log('选择的文件不是图片!');
                  return;
                }
                /**
                 * @description 我宣布个事嗷,我是个傻逼!
                 */
                // 截取文件后缀名;
                // let suffix = file.type.substring(file.type.indexOf('/') + 1,file.type.length);
                // console.log('后缀名 = ' + suffix);
                let uploadPath = randomString() + file.name;
                let upToken = sessionStorage.getItem('upToken');
                formData.append('token', upToken);
                formData.append('key', uploadPath);
                // console.log(formData.get('file'));
              }
            },
            toolbar: {
              container: container,
              handlers: {
                'image': function (value) {
                  QuillWatch.emit(this.quill.id)
                }
              }
            }
          }
        }
      }
    },
    methods: {
      showContent(){
        console.log(this.content);
        console.log(this.editor.getFormat());
      },
      // 获取上传七牛云上传凭证;
      getUptoken: function(){
        
        let xhr = new XMLHttpRequest();
          xhr.open('GET', 'http://localhost:8081/getUptoken', true);
          xhr.onreadystatechange = function() {
            if(xhr.readyState === 4 && xhr.status === 200){
              this.upToken = JSON.parse(xhr.responseText).data;
              sessionStorage.setItem('upToken', this.upToken);
              return;
            }
          };
          xhr.send();
      }
    },
    computed: {
      editor() {
        return this.$refs.myQuillEditor.quill
      }
    },
    mounted() {
      this.getUptoken();
      console.log('this is current quill instance object', this.editor)
      this.editor.scrollingContainer.innerHTML = this.content;
    }
}
</script>

<style scoped>
.quill-wrap{
  overflow-y: auto;
}
.ql-editor {
  height: 800px;
  max-height: 800px;
  overflow-y: auto;
}
</style>